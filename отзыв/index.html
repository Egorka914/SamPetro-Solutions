<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–û—Ç–∑—ã–≤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
    <link rel="icon" href="logo.jpg" type="image/png">
</head>
<body>

  <h1>–û—Ç–∑—ã–≤—ã</h1>

  <form id="reviewForm">
    <input type="text" id="name" placeholder="–í–∞—à–µ –∏–º—è" required>
    <textarea id="message" placeholder="–í–∞—à –æ—Ç–∑—ã–≤" rows="4" required></textarea>
    <button type="submit">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
  </form>

  <div id="reviewsContainer"></div>

  <!-- –°–∫—Ä—ã—Ç–∞—è –∑–æ–Ω–∞ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω–∫—É -->
  <div id="adminTrigger" title="–ê–¥–º–∏–Ω –≤—Ö–æ–¥"></div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxy0ZtDQwurW9hn5x8aIkTBr-Eyfgaea8gZ5vXiMZmbITpRk7m-a6OioNk_Oy6mt5iX/exec"; // üîó —Å—é–¥–∞ –≤—Å—Ç–∞–≤—å —Å—Å—ã–ª–∫—É –∏–∑ Apps Script
    const form = document.getElementById('reviewForm');
    const reviewsContainer = document.getElementById('reviewsContainer');
    const adminTrigger = document.getElementById('adminTrigger');

    let isAdmin = false;
    const adminPassword = '1'; // üîê –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞

    // –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–∑—ã–≤–æ–≤ –∏–∑ Google Sheets
    async function loadReviews() {
      try {
        const res = await fetch(API_URL);
        const reviews = await res.json();
        renderAllReviews(reviews);
      } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", err);
      }
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –æ—Ç–∑—ã–≤–æ–≤
    function renderAllReviews(reviews) {
      reviewsContainer.innerHTML = '';
      reviews.forEach((review, index) => {
        addReviewToDOM(review.name, review.message, index);
      });
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –æ—Ç–∑—ã–≤–∞
    function addReviewToDOM(name, message, index) {
      const review = document.createElement('div');
      review.className = 'review';
      if (isAdmin) review.classList.add('admin');

      review.innerHTML = `
        <strong>${name}</strong>
        <p>${message}</p>
        ${isAdmin ? `<button class="delete-btn" data-index="${index}">–£–¥–∞–ª–∏—Ç—å</button>` : ""}
      `;

      if (isAdmin) {
        review.querySelector('.delete-btn').addEventListener('click', async function () {
          await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ delete: index }) // üóëÔ∏è –∫–æ–º–∞–Ω–¥–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ
          });
          loadReviews();
        });
      }

      reviewsContainer.appendChild(review); // –æ—Ç–∑—ã–≤—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤–Ω–∏–∑—É
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –æ—Ç–∑—ã–≤–∞
    form.addEventListener('submit', async function (e) {
      e.preventDefault();

      const name = document.getElementById('name').value.trim();
      const message = document.getElementById('message').value.trim();

      if (name && message) {
        await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, message })
        });
        form.reset();
        loadReviews();
      }
    });

    // üîê –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É
    adminTrigger.addEventListener('click', function () {
      const input = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:');
      if (input === adminPassword) {
        isAdmin = true;
        alert('–†–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤–∫–ª—é—á—ë–Ω');
        loadReviews();
      } else if (input !== null) {
        alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
      }
    });

    loadReviews();
  </script>

</body>
</html>
