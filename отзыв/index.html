<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Отзыв</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
    <link rel="icon" href="logo.jpg" type="image/png">
</head>
<body>

  <h1>Отзыв</h1>

  <form id="reviewForm">
    <input type="text" id="name" placeholder="Ваше имя" required>
    <textarea id="message" placeholder="Ваш отзыв" rows="4" required></textarea>
    <button type="submit">Оставить отзыв</button>
  </form>

  <div id="reviewsContainer"></div>

  <!-- Скрытая зона для входа в админку -->
  <div id="adminTrigger" title="Админ вход"></div>

<script>
  const form = document.getElementById('reviewForm');
  const reviewsContainer = document.getElementById('reviewsContainer');
  const adminTrigger = document.getElementById('adminTrigger');

  let savedReviews = [];
  let isAdmin = false;
  const adminPassword = '1';
  const API_URL = "https://script.google.com/macros/s/AKfycby6zp6L_7Iht--ebNsiMY2d61uU-COEbK5eQivSkKnQ_XvVxiA10pF-3t2rXvXZr9U/exec"; // вставь сюда URL

  async function loadReviews() {
    const res = await fetch(API_URL + "?t=" + Date.now()); // чтобы не кэшировало
    savedReviews = await res.json();
    renderAllReviews();
  }

  function renderAllReviews() {
    reviewsContainer.innerHTML = '';
    [...savedReviews].reverse().forEach((review) => {
      addReviewToDOM(review.name, review.message, review.row);
    });
  }

  function addReviewToDOM(name, message, row) {
    const review = document.createElement('div');
    review.className = 'review';
    if (isAdmin) review.classList.add('admin');

    review.innerHTML = `
      <strong>${name}</strong>
      <p>${message}</p>
      ${isAdmin ? `<button class="delete-btn" data-row="${row}">Удалить</button>` : ""}
    `;

    if (isAdmin) {
      review.querySelector('.delete-btn').addEventListener('click', async function () {
        const rowToDelete = this.dataset.row;
        await fetch(API_URL, {
          method: "POST",
          body: JSON.stringify({ action: "delete", row: parseInt(rowToDelete) })
        });
        loadReviews();
      });
    }

    reviewsContainer.prepend(review);
  }

  form.addEventListener('submit', async function (e) {
    e.preventDefault();

    const name = document.getElementById('name').value.trim();
    const message = document.getElementById('message').value.trim();

    if (name && message) {
      await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "add", name, message })
      });
      form.reset();
      loadReviews();
    }
  });

  adminTrigger.addEventListener('click', function () {
    const input = prompt('Введите пароль администратора:');
    if (input === adminPassword) {
      isAdmin = true;
      alert('Режим администратора включён');
      renderAllReviews();
    } else if (input !== null) {
      alert('Неверный пароль');
    }
  });

  loadReviews();
</script>




</body>
</html>